{"version":3,"sources":["../../../../src/js/components/Content/index.js"],"names":["Content","state","summary","promptPrefix","prompt","history","historyCounter","input","keyInputs","canScroll","controller","componentWillMount","data","context","instances","find","i","index","props","id","oldData","setState","componentDidMount","focusInput","unregister","register","keys","length","handleChange","target","value","key","dontShowCommand","componentDidUpdate","inputWrapper","scrollIntoView","setScrollPosition","pos","setTimeout","contentWrapper","scrollTop","com","focus","e","handleKeyPress","handlerKeyPress","handleOuterKeypress","indexOf","document","activeElement","char","maximise","activeTab","barShowing","tabsShowing","output","map","content","Array","isArray","cont","marginRight","toSubtract","maxWidth","maxHeight","overflowY","ctw","elm","displayName","propTypes","string","object","func","isRequired","defaultProps","contextTypes","bool","array"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport whatkey, { unprintableKeys } from 'whatkey';\nimport {\n  ContainerMain, ContainerContent, Holder,\n  Input, InputArea, MainInput,\n  OutputLine, PreOutputLine, Prompt,\n} from './styled-elements';\n\nclass Content extends Component {\n  static displayName = 'Content';\n\n  static propTypes = {\n    id: PropTypes.string,\n    oldData: PropTypes.object, // eslint-disable-line\n    prompt: PropTypes.string,\n    register: PropTypes.func,\n    handleChange: PropTypes.func,\n    handlerKeyPress: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = {\n    prompt: '>',\n    oldData: {},\n  };\n\n  static contextTypes = {\n    maximise: PropTypes.bool,\n    instances: PropTypes.array,\n    activeTab: PropTypes.string,\n    barShowing: PropTypes.bool,\n    tabsShowing: PropTypes.bool,\n  };\n\n  state = {\n    summary: [],\n    promptPrefix: '',\n    prompt: '>',\n    history: [],\n    historyCounter: 0,\n    input: [],\n    keyInputs: [],\n    canScroll: true,\n    controller: null,\n  };\n\n  componentWillMount = () => {\n    const data = this.context.instances.find(i => i.index === this.props.id);\n    let state = { prompt: this.props.prompt };\n    if (data) {\n      state = { ...state, ...data.oldData };\n    }\n    this.setState(state);\n  };\n\n  componentDidMount = () => {\n    this.focusInput();\n    const data = this.context.instances.find(i => i.index === this.props.id);\n    this.unregister = this.props.register(this);\n    if (!data || Object.keys(data.oldData).length === 0) {\n      this.handleChange({ target: { value: 'show' }, key: 'Enter', dontShowCommand: true });\n    }\n  };\n\n  // Adjust scrolling\n  componentDidUpdate = () => {\n    if (this.inputWrapper !== null) {\n      this.inputWrapper.scrollIntoView(false);\n    }\n  };\n\n  componentWillUnmount() {\n    this.unregister(this.state);\n  }\n\n  setScrollPosition = (pos) => {\n    setTimeout(() => {\n      if (this.contentWrapper !== null) {\n        this.contentWrapper.scrollTop = pos;\n      }\n    }, 50);\n  };\n\n  focusInput = () => {\n    if (this.com !== null) {\n      this.com.focus();\n    }\n  };\n\n  handleChange = (e) => {\n    this.props.handleChange(this, e);\n  }\n\n  handleKeyPress = (e) => {\n    this.props.handlerKeyPress(this, e, this.com);\n  }\n\n  handleOuterKeypress = (e) => {\n    const { key } = whatkey(e);\n    const actionKeys = ['up', 'down', 'left', 'right', 'enter'];\n    if (unprintableKeys.indexOf(key) < 0) {\n      if (document.activeElement !== this.com) {\n        this.com.focus();\n        this.com.value += whatkey(e).char;\n      }\n    } else if (actionKeys.indexOf(key) > -1) {\n      this.com.focus();\n    }\n  }\n\n  render() {\n    const { id } = this.props;\n    const {\n      maximise, activeTab, barShowing, tabsShowing,\n    } = this.context;\n\n    if (id !== activeTab) {\n      return null;\n    }\n\n    const output = this.state.summary.map((content, i) => {\n      if (typeof content === 'string' && content.length === 0) {\n        return <OutputLine key={i}>&nbsp;</OutputLine>;\n      }\n      return (\n        <PreOutputLine key={i}>\n          {\n            Array.isArray(content) ?\n            content.map((cont, key) => (\n              <span style={{ marginRight: 5 }} key={`inner-${key}`}>{cont}</span>\n            )) :\n            content\n          }\n        </PreOutputLine>\n      );\n    });\n\n    let toSubtract = 30;\n    if (!barShowing) {\n      toSubtract -= 30;\n    }\n    if (tabsShowing) {\n      toSubtract += 30;\n    }\n\n    return (\n      <ContainerMain\n        style={{\n          ...(maximise\n            ? { maxWidth: '100%', maxHeight: `calc(100% - ${toSubtract}px)` }\n            : {}),\n          ...(this.state.canScroll\n            ? { overflowY: 'auto' }\n            : { overflowY: 'hidden' }),\n        }}\n        tabIndex=\"0\"\n        onKeyUp={this.handleOuterKeypress}\n        innerRef={(ctw) => { this.contentWrapper = ctw; }}\n      >\n        <Holder>\n          <ContainerContent>\n            <InputArea>\n              {output}\n              <Input\n                innerRef={(elm) => { this.inputWrapper = elm; }}\n              >\n                <Prompt>\n                  {this.state.promptPrefix + this.state.prompt}\n                </Prompt>\n                <MainInput\n                  type=\"text\"\n                  tabIndex=\"-1\"\n                  innerRef={(com) => { this.com = com; }}\n                  onKeyPress={this.handleChange}\n                  onKeyDown={this.handleKeyPress}\n                />\n              </Input>\n            </InputArea>\n          </ContainerContent>\n        </Holder>\n      </ContainerMain>\n    );\n  }\n}\n\nexport default Content;\n"]}